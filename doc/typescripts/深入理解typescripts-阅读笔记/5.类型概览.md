# TypeScript ç±»å‹ç³»ç»Ÿæ¦‚è§ˆ

## TypeScript ç±»å‹ç³»ç»Ÿç®€ä»‹

åœ¨è®¨è®ºä¸ºä»€ä¹ˆä½¿ç”¨ TypeScript æ—¶ï¼Œæˆ‘ä»¬è¡¨è¿°äº† TypeScript ç±»å‹ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹ï¼š

- **TypeScript çš„ç±»å‹ç³»ç»Ÿè¢«è®¾è®¡ä¸ºå¯é€‰çš„**ï¼Œå› æ­¤ï¼Œä½ çš„ JavaScript å°±æ˜¯ TypeScript
- **TypeScript ä¸ä¼šé˜»æ­¢ JavaScript çš„è¿è¡Œ**ï¼Œå³ä½¿å­˜åœ¨ç±»å‹é”™è¯¯ä¹Ÿä¸ä¾‹å¤–ï¼Œè¿™èƒ½è®©ä½ çš„ JavaScript é€æ­¥è¿ç§»è‡³ TypeScript

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å­¦ä¹  TypeScript ç±»å‹ç³»ç»Ÿçš„è¯­æ³•å§ï¼Œåœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œä½ å°†èƒ½ç»™ä½ çš„ä»£ç åŠ ä¸Šç±»å‹æ³¨è§£ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°å®ƒçš„ç›Šå¤„ã€‚

## åŸºæœ¬æ³¨è§£

ç±»å‹æ³¨è§£ä½¿ç”¨ `:TypeAnnotation` è¯­æ³•ã€‚åœ¨ç±»å‹å£°æ˜ç©ºé—´ä¸­å¯ç”¨çš„ä»»ä½•å†…å®¹éƒ½å¯ä»¥ç”¨ä½œç±»å‹æ³¨è§£ã€‚

åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†å˜é‡ã€å‡½æ•°å‚æ•°ä»¥åŠå‡½æ•°è¿”å›å€¼çš„ç±»å‹æ³¨è§£ï¼š

```typescript
const num: number = 123;
function identity(num: number): number {
  return num;
}
```

## åŸå§‹ç±»å‹

JavaScript åŸå§‹ç±»å‹ä¹ŸåŒæ ·é€‚åº”äº TypeScript çš„ç±»å‹ç³»ç»Ÿï¼Œå› æ­¤ `string`ã€`number`ã€`boolean` ä¹Ÿå¯ä»¥è¢«ç”¨ä½œç±»å‹æ³¨è§£ï¼š

```typescript
let num: number;
let str: string;
let bool: boolean;

num = 123;
num = 123.456;
num = '123'; // Error

str = '123';
str = 123; // Error

bool = true;
bool = false;
bool = 'false'; // Error
```

### åŸå§‹ç±»å‹è¯¦è§£

- **`number`**ï¼šåŒ…æ‹¬æ•´æ•°å’Œæµ®ç‚¹æ•°
- **`string`**ï¼šå­—ç¬¦ä¸²ç±»å‹
- **`boolean`**ï¼šå¸ƒå°”å€¼ `true` æˆ– `false`
- **`symbol`**ï¼šES2015 å¼•å…¥çš„ç¬¦å·ç±»å‹
- **`bigint`**ï¼šES2020 å¼•å…¥çš„å¤§æ•´æ•°ç±»å‹

```typescript
let id: symbol = Symbol('id');
let bigNumber: bigint = 123n;
```

## æ•°ç»„

TypeScript ä¸ºæ•°ç»„æä¾›äº†ä¸“ç”¨çš„ç±»å‹è¯­æ³•ï¼Œå› æ­¤ä½ å¯ä»¥å¾ˆè½»æ˜“çš„æ³¨è§£æ•°ç»„ã€‚å®ƒä½¿ç”¨åç¼€ `[]`ï¼Œæ¥ç€ä½ å¯ä»¥æ ¹æ®éœ€è¦è¡¥å……ä»»ä½•æœ‰æ•ˆçš„ç±»å‹æ³¨è§£ï¼ˆå¦‚ï¼š`:boolean[]`ï¼‰ã€‚

```typescript
let boolArray: boolean[];

boolArray = [true, false];
console.log(boolArray[0]); // true
console.log(boolArray.length); // 2

boolArray[1] = true;
boolArray = [false, false];

boolArray[0] = 'false'; // Error
boolArray = 'false'; // Error
boolArray = [true, 'false']; // Error
```

### æ•°ç»„çš„å…¶ä»–å†™æ³•

```typescript
// æ–¹å¼ä¸€ï¼šç±»å‹ + []
let numbers: number[] = [1, 2, 3];

// æ–¹å¼äºŒï¼šæ³›å‹å†™æ³•
let strings: Array<string> = ['a', 'b', 'c'];

// æ–¹å¼ä¸‰ï¼šåªè¯»æ•°ç»„
let readonlyNumbers: readonly number[] = [1, 2, 3];
let readonlyStrings: ReadonlyArray<string> = ['a', 'b'];
```

## æ¥å£

æ¥å£æ˜¯ TypeScript çš„ä¸€ä¸ªæ ¸å¿ƒçŸ¥è¯†ï¼Œå®ƒèƒ½åˆå¹¶ä¼—å¤šç±»å‹å£°æ˜è‡³ä¸€ä¸ªç±»å‹å£°æ˜ï¼š

```typescript
interface Name {
  first: string;
  second: string;
}

let name: Name;
name = {
  first: 'John',
  second: 'Doe'
};

name = {
  // Error: 'second is missing'
  first: 'John'
};

name = {
  // Error: 'second is the wrong type'
  first: 'John',
  second: 1337
};
```

### æ¥å£çš„é«˜çº§ç‰¹æ€§

```typescript
interface User {
  id: number;
  name: string;
  age?: number; // å¯é€‰å±æ€§
  readonly email: string; // åªè¯»å±æ€§
}

// ç´¢å¼•ç­¾å
interface StringDictionary {
  [key: string]: string;
}

// å‡½æ•°ç±»å‹
interface SearchFunc {
  (source: string, subString: string): boolean;
}
```

## å†…è”ç±»å‹æ³¨è§£

ä¸åˆ›å»ºä¸€ä¸ªæ¥å£ä¸åŒï¼Œä½ å¯ä»¥ä½¿ç”¨å†…è”æ³¨è§£è¯­æ³•æ³¨è§£ä»»ä½•å†…å®¹ï¼š`:{ /*Structure*/ }`ï¼š

```typescript
let name: {
  first: string;
  second: string;
};

name = {
  first: 'John',
  second: 'Doe'
};

name = {
  // Error: 'second is missing'
  first: 'John'
};

name = {
  // Error: 'second is the wrong type'
  first: 'John',
  second: 1337
};
```

å†…è”ç±»å‹èƒ½ä¸ºä½ å¿«é€Ÿçš„æä¾›ä¸€ä¸ªç±»å‹æ³¨è§£ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ çœå»ä¸ºç±»å‹èµ·åçš„éº»çƒ¦ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å‘ç°éœ€è¦å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å†…è”æ³¨è§£æ—¶ï¼Œé‚£ä¹ˆè€ƒè™‘æŠŠå®ƒé‡æ„ä¸ºä¸€ä¸ªæ¥å£ï¼ˆæˆ–è€…æ˜¯ `type alias`ï¼Œæˆ‘ä»¬ç¨åä¼šæåŠï¼‰æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ã€‚

## ç‰¹æ®Šç±»å‹

é™¤äº†åŸå§‹ç±»å‹ï¼Œåœ¨ TypeScript ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒä»¬æ˜¯ï¼š`any`ã€`null` å’Œ `undefined`ã€`void`ã€‚

### any

`any` ç±»å‹èƒ½å¤Ÿå…¼å®¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ã€‚å› æ­¤ï¼Œæ‰€æœ‰ç±»å‹éƒ½èƒ½è¢«èµ‹å€¼ç»™å®ƒï¼Œå®ƒä¹Ÿèƒ½è¢«èµ‹å€¼ç»™å…¶ä»–ä»»ä½•ç±»å‹ã€‚

```typescript
let power: any;

// èµ‹å€¼ä»»æ„ç±»å‹
power = '123';
power = 123;

// å®ƒä¹Ÿå…¼å®¹ä»»ä½•ç±»å‹
let num: number;
power = num;
num = power;
```

å½“ä½ æŠŠ JavaScript è¿ç§»è‡³ TypeScript æ—¶ï¼Œä½ å°†ä¼šç»å¸¸æ€§ä½¿ç”¨ `any`ã€‚ä½†ä½ å¿…é¡»å‡å°‘å¯¹å®ƒçš„ä¾èµ–ï¼Œå› ä¸ºä½ éœ€è¦ç¡®ä¿ç±»å‹å®‰å…¨ã€‚å½“ä½¿ç”¨ `any` æ—¶ï¼Œä½ åŸºæœ¬ä¸Šæ˜¯åœ¨å‘Šè¯‰ TypeScript ç¼–è¯‘å™¨ä¸è¦è¿›è¡Œä»»ä½•çš„ç±»å‹æ£€æŸ¥ã€‚

### null å’Œ undefined

åœ¨ç±»å‹ç³»ç»Ÿä¸­ï¼ŒJavaScript ä¸­çš„ `null` å’Œ `undefined` å­—é¢é‡å’Œå…¶ä»–è¢«æ ‡æ³¨äº† `any` ç±»å‹çš„å˜é‡ä¸€æ ·ï¼Œéƒ½èƒ½è¢«èµ‹å€¼ç»™ä»»æ„ç±»å‹çš„å˜é‡ï¼š

```typescript
// strictNullChecks: false

let num: number;
let str: string;

// è¿™äº›ç±»å‹èƒ½è¢«èµ‹äºˆ
num = null;
str = undefined;
```

### void

ä½¿ç”¨ `:void` æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼š

```typescript
function log(message: string): void {
  console.log(message);
}
```

### never

`never` ç±»å‹è¡¨ç¤ºæ°¸è¿œä¸ä¼šå‘ç”Ÿçš„å€¼çš„ç±»å‹ï¼š

```typescript
function error(message: string): never {
  throw new Error(message);
}

function infiniteLoop(): never {
  while (true) {
    // æ— é™å¾ªç¯
  }
}
```

### unknown

`unknown` ç±»å‹æ˜¯ `any` ç±»å‹çš„å®‰å…¨ç‰ˆæœ¬ï¼š

```typescript
let value: unknown;

value = 42;
value = "hello";
value = true;

// ä½¿ç”¨å‰éœ€è¦ç±»å‹æ£€æŸ¥
if (typeof value === "string") {
  console.log(value.toUpperCase()); // OK
}
```

## æ³›å‹

åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œè®¸å¤šç®—æ³•å’Œæ•°æ®ç»“æ„å¹¶ä¸ä¼šä¾èµ–äºå¯¹è±¡çš„å®é™…ç±»å‹ã€‚ä½†æ˜¯ï¼Œä½ ä»ç„¶ä¼šæƒ³åœ¨æ¯ä¸ªå˜é‡é‡Œå¼ºåˆ¶æä¾›çº¦æŸã€‚

```typescript
function reverse<T>(items: T[]): T[] {
  const toReturn = [];
  for (let i = items.length - 1; i >= 0; i--) {
    toReturn.push(items[i]);
  }
  return toReturn;
}

const sample = [1, 2, 3];
let reversed = reverse(sample);

console.log(reversed); // 3, 2, 1

// Safety
reversed[0] = '1'; // Error
reversed = ['1', '2']; // Error

reversed[0] = 1; // ok
reversed = [1, 2]; // ok
```

### æ³›å‹çº¦æŸ

```typescript
interface Lengthwise {
  length: number;
}

function loggingIdentity<T extends Lengthwise>(arg: T): T {
  console.log(arg.length); // ç°åœ¨æˆ‘ä»¬çŸ¥é“å®ƒæœ‰ length å±æ€§
  return arg;
}
```

### æ³›å‹æ¥å£

```typescript
interface GenericIdentityFn<T> {
  (arg: T): T;
}

function identity<T>(arg: T): T {
  return arg;
}

let myIdentity: GenericIdentityFn<number> = identity;
```

## è”åˆç±»å‹

åœ¨ JavaScript ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›å±æ€§ä¸ºå¤šç§ç±»å‹ä¹‹ä¸€ï¼Œå¦‚å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ã€‚è¿™æ­£æ˜¯ TypeScript ä¸­è”åˆç±»å‹èƒ½æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ï¼ˆå®ƒä½¿ç”¨ `|` ä½œä¸ºæ ‡è®°ï¼Œå¦‚ `string | number`ï¼‰ã€‚

```typescript
function formatCommandline(command: string[] | string) {
  let line = '';
  if (typeof command === 'string') {
    line = command.trim();
  } else {
    line = command.join(' ').trim();
  }

  // Do stuff with line: string
}
```

### è”åˆç±»å‹çš„ç±»å‹ä¿æŠ¤

```typescript
type NetworkLoadingState = {
  state: "loading";
};

type NetworkFailedState = {
  state: "failed";
  code: number;
};

type NetworkSuccessState = {
  state: "success";
  response: {
    title: string;
    duration: number;
    summary: string;
  };
};

type NetworkState =
  | NetworkLoadingState
  | NetworkFailedState
  | NetworkSuccessState;

function handleNetworkState(state: NetworkState) {
  switch (state.state) {
    case "loading":
      // åœ¨è¿™é‡Œ state æ˜¯ NetworkLoadingState
      break;
    case "failed":
      // åœ¨è¿™é‡Œ state æ˜¯ NetworkFailedState
      console.log(state.code);
      break;
    case "success":
      // åœ¨è¿™é‡Œ state æ˜¯ NetworkSuccessState
      console.log(state.response.title);
      break;
  }
}
```

## äº¤å‰ç±»å‹

åœ¨ JavaScript ä¸­ï¼Œ`extend` æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä»ä¸¤ä¸ªå¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡æ‹¥æœ‰ç€ä¸¤ä¸ªå¯¹è±¡æ‰€æœ‰çš„åŠŸèƒ½ã€‚äº¤å‰ç±»å‹å¯ä»¥è®©ä½ å®‰å…¨çš„ä½¿ç”¨æ­¤ç§æ¨¡å¼ï¼š

```typescript
function extend<T extends object, U extends object>(first: T, second: U): T & U {
  const result = <T & U>{};
  for (let id in first) {
    (<T>result)[id] = first[id];
  }
  for (let id in second) {
    if (!result.hasOwnProperty(id)) {
      (<U>result)[id] = second[id];
    }
  }

  return result;
}

const x = extend({ a: 'hello' }, { b: 42 });

// ç°åœ¨ x æ‹¥æœ‰äº† a å±æ€§ä¸ b å±æ€§
const a = x.a;
const b = x.b;
```

### äº¤å‰ç±»å‹çš„å®é™…åº”ç”¨

```typescript
interface Colorful {
  color: string;
}

interface Circle {
  radius: number;
}

type ColorfulCircle = Colorful & Circle;

const colorfulCircle: ColorfulCircle = {
  color: "red",
  radius: 42,
};
```

## å…ƒç»„ç±»å‹

JavaScript å¹¶ä¸æ”¯æŒå…ƒç»„ï¼Œå¼€å‘è€…ä»¬é€šå¸¸åªèƒ½ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤ºå…ƒç»„ã€‚è€Œ TypeScript æ”¯æŒå®ƒï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ `:[typeofmember1, typeofmember2]` çš„å½¢å¼ï¼Œä¸ºå…ƒç»„æ·»åŠ ç±»å‹æ³¨è§£ï¼š

```typescript
let nameNumber: [string, number];

// Ok
nameNumber = ['Jenny', 221345];

// Error
nameNumber = ['Jenny', '221345'];
```

### å…ƒç»„çš„è§£æ„ä½¿ç”¨

```typescript
let nameNumber: [string, number];
nameNumber = ['Jenny', 322134];

const [name, num] = nameNumber;
```

### å¯é€‰å…ƒç»„å…ƒç´ 

```typescript
type Either2dOr3d = [number, number, number?];

function setCoordinate(coord: Either2dOr3d) {
  const [x, y, z] = coord;
  console.log(`Provided coordinates had ${coord.length} dimensions`);
}
```

### å‰©ä½™å…ƒç´ 

```typescript
type StringNumberBooleans = [string, number, ...boolean[]];
type StringBooleansNumber = [string, ...boolean[], number];
type BooleansStringNumber = [...boolean[], string, number];
```

## ç±»å‹åˆ«å

TypeScript æä¾›äº†ä¸ºç±»å‹æ³¨è§£è®¾ç½®åˆ«åçš„ä¾¿æ·è¯­æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ `type SomeName = someValidTypeAnnotation` æ¥åˆ›å»ºåˆ«åï¼š

```typescript
type StrOrNum = string | number;

// ä½¿ç”¨
let sample: StrOrNum;
sample = 123;
sample = '123';

// ä¼šæ£€æŸ¥ç±»å‹
sample = true; // Error
```

### å¤æ‚ç±»å‹åˆ«åç¤ºä¾‹

```typescript
type Text = string | { text: string };
type Coordinates = [number, number];
type Callback = (data: string) => void;

// å‡½æ•°ç±»å‹åˆ«å
type EventHandler = (event: MouseEvent) => void;

// æ¡ä»¶ç±»å‹åˆ«å
type NonNullable<T> = T extends null | undefined ? never : T;

// æ˜ å°„ç±»å‹åˆ«å
type Readonly<T> = {
  readonly [P in keyof T]: T[P];
};
```

## ç±»å‹åˆ«å vs æ¥å£

### ç›¸åŒç‚¹

```typescript
// æ¥å£
interface Point {
  x: number;
  y: number;
}

// ç±»å‹åˆ«å
type Point2 = {
  x: number;
  y: number;
};
```

### ä¸åŒç‚¹

**æ¥å£å¯ä»¥æ‰©å±•ï¼š**

```typescript
interface Animal {
  name: string;
}

interface Bear extends Animal {
  honey: boolean;
}
```

**ç±»å‹åˆ«åæ”¯æŒè”åˆç±»å‹ï¼š**

```typescript
type StringOrNumber = string | number;
type EventNames = 'click' | 'scroll' | 'mousemove';
```

**æ¥å£å¯ä»¥åˆå¹¶å£°æ˜ï¼š**

```typescript
interface Window {
  title: string;
}

interface Window {
  ts: TypeScriptAPI;
}

// ç›¸å½“äº
interface Window {
  title: string;
  ts: TypeScriptAPI;
}
```

## ä½¿ç”¨å»ºè®®

### ğŸ“ é€‰æ‹©æŒ‡å—

- **å¦‚æœä½ éœ€è¦ä½¿ç”¨ç±»å‹æ³¨è§£çš„å±‚æ¬¡ç»“æ„ï¼Œè¯·ä½¿ç”¨æ¥å£**ã€‚å®ƒèƒ½ä½¿ç”¨ `implements` å’Œ `extends`
- **ä¸ºä¸€ä¸ªç®€å•çš„å¯¹è±¡ç±»å‹ä½¿ç”¨ç±»å‹åˆ«å**ï¼Œåªéœ€è¦ç»™å®ƒä¸€ä¸ªè¯­ä¹‰åŒ–çš„åå­—å³å¯
- **å½“ä½ æƒ³ç»™è”åˆç±»å‹å’Œäº¤å‰ç±»å‹æä¾›ä¸€ä¸ªè¯­ä¹‰åŒ–çš„åç§°æ—¶ï¼Œä¸€ä¸ªç±»å‹åˆ«åå°†ä¼šæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©**

### æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨æ¥å£**ï¼šå¯¹äºå¯¹è±¡ç±»å‹çš„å®šä¹‰
2. **ç±»å‹åˆ«åç”¨äºå¤æ‚ç±»å‹**ï¼šè”åˆç±»å‹ã€äº¤å‰ç±»å‹ã€å·¥å…·ç±»å‹
3. **ä¿æŒä¸€è‡´æ€§**ï¼šåœ¨åŒä¸€é¡¹ç›®ä¸­ä¿æŒå‘½åé£æ ¼ä¸€è‡´
4. **é¿å… any**ï¼šå°½é‡ä½¿ç”¨å…·ä½“çš„ç±»å‹æ³¨è§£
5. **åˆ©ç”¨ç±»å‹æ¨æ–­**ï¼šè®© TypeScript è‡ªåŠ¨æ¨æ–­ç®€å•ç±»å‹

```typescript
// âœ… å¥½çš„å®è·µ
interface User {
  id: number;
  name: string;
  email: string;
}

type Status = 'loading' | 'success' | 'error';
type ApiResponse<T> = {
  data: T;
  status: Status;
  message?: string;
};

// âŒ é¿å…çš„å†™æ³•
let userData: any; // è¿‡äºå®½æ³›
let userInfo: {}; // æ²¡æœ‰æä¾›æœ‰ç”¨ä¿¡æ¯
```

## æ€»ç»“

ç°åœ¨ä½ å·²ç»èƒ½å¤Ÿä¸ºä½ çš„å¤§éƒ¨åˆ† JavaScript ä»£ç æ·»åŠ ç±»å‹æ³¨è§£äº†ã€‚TypeScript çš„ç±»å‹ç³»ç»ŸåŒ…æ‹¬ï¼š

- **åŸºç¡€ç±»å‹**ï¼š`string`ã€`number`ã€`boolean` ç­‰
- **å¤åˆç±»å‹**ï¼šæ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°
- **é«˜çº§ç±»å‹**ï¼šæ³›å‹ã€è”åˆç±»å‹ã€äº¤å‰ç±»å‹ã€å…ƒç»„
- **ç±»å‹å·¥å…·**ï¼šæ¥å£ã€ç±»å‹åˆ«åã€ç±»å‹æ–­è¨€
- **ç‰¹æ®Šç±»å‹**ï¼š`any`ã€`unknown`ã€`never`ã€`void`

æŒæ¡è¿™äº›åŸºç¡€çŸ¥è¯†å°†ä¸ºä½ æ·±å…¥å­¦ä¹  TypeScript æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚

å‚è€ƒï¼š[æ·±å…¥ç†è§£ TypeScript - ç±»å‹ç³»ç»Ÿæ¦‚è§ˆ](https://jkchao.github.io/typescript-book-chinese/typings/overview.html)
